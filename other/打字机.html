<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypeMaster</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f6f8; /* 更柔和的背景色 */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* 更现代的字体 */
            flex-direction: column;
            color: #333;
            margin: 0;
        }
        #game-container {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1); /* 更强的阴影效果 */
            padding: 40px;
            width: 85%;
            max-width: 700px; /* 稍微增加最大宽度 */
            text-align: center;
            position: relative;
        }
        h1 {
            color: #2c3e50; /* 更深的标题颜色 */
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 700;
        }
        #lines-wrapper {
            position: relative;
            height: 4em;
            overflow: hidden;
            margin: 30px 0;
        }
        .line {
            display: flex;
            justify-content: center;
            font-size: 2.2em; /* 稍微增大字体 */
            letter-spacing: 0.15em; /* 调整字母间距 */
            white-space: nowrap;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            transition: top 0.3s ease-in-out; /* 更平滑的过渡 */
        }
        .char {
            color: #555; /* 更柔和的默认颜色 */
            transition: color 0.15s, font-weight 0.15s;
            position: relative;
            padding: 0 4px; /* 增加一些内边距 */
        }
        .char.correct {
            color: #27ae60; /* 更鲜艳的正确颜色 */
            font-weight: 600; /* 稍微细一点的加粗 */
        }
        .char.current::after {
            content: '';
            position: absolute;
            bottom: -6px; /* 调整下划线位置 */
            left: 0;
            right: 0;
            height: 2px;
            background-color: #3498db; /* 更醒目的下划线颜色 */
            /* animation: blink-caret 1s step-end infinite; */ /* 移除闪烁动画 */
        }
        /* @keyframes blink-caret {
            from, to { background-color: transparent; }
            50% { background-color: #3498db; }
        } */
        #initial-message {
            font-size: 1.6em;
            color: #777;
            margin-bottom: 20px;
        }
        #stats-container {
            margin-top: 40px;
            padding: 30px;
            background-color: #ecf0f1; /* 更浅的背景 */
            border-radius: 8px;
            text-align: left;
            font-size: 1.1em;
            color: #444;
            border: 1px solid #d3d3d3;
        }
        #stats-container h3 {
            margin-top: 0;
            color: #c0392b;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        .stats-item {
            margin-bottom: 8px;
        }
        .stats-item span {
            font-weight: 600;
            color: #3498db;
        }
        #restart-message {
            font-style: italic;
            color: #999;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>TypeMaster</h1>
        <div id="lines-wrapper">
            </div>
        <p id="initial-message">按 <span style="font-weight: bold;">Enter</span> 开始!</p>
    </div>
    <div id="stats-container">
        <h3>游戏结束</h3>
        <p class="stats-item">本次成绩:</p>
        <p class="stats-item">正确字母数: <span id="current-correct">0</span></p>
        <p class="stats-item">用时: <span id="current-time">0</span> 秒</p>
        <p class="stats-item">速度: <span id="current-wpm">0</span> 字母/秒</p>
        <hr style="border-top: 1px solid #ddd; margin: 15px 0;">
        <p class="stats-item">最佳记录:</p>
        <p class="stats-item">最多正确: <span id="best-correct">0</span></p>
        <p class="stats-item">最快用时: <span id="best-time">0</span> 秒</p>
        <p class="stats-item">最快速度: <span id="best-wpm">0</span> 字母/秒</p>
        <p id="restart-message">按 <span style="font-weight: bold;">Enter</span> 再玩一次!</p>
    </div>

    <script>
        const alphabet = 'abcdefghijklmnopqrstuvwxyz';
        const linesWrapper = document.getElementById('lines-wrapper');
        const statsContainer = document.getElementById('stats-container');
        const initialMessage = document.getElementById('initial-message');

        let lines = [];
        let currentCharIndex = 0;
        let gameStarted = false;
        let startTime = 0;
        let correctCharsCount = 0;

        let bestScore = {
            correct: 0,
            time: Infinity,
            wpm: 0
        };

        document.addEventListener('keydown', handleKeyDown);

        function generateRandomLine() {
            let line = '';
            for (let i = 0; i < 10; i++) {
                line += alphabet.charAt(Math.floor(Math.random() * alphabet.length));
            }
            return line;
        }

        function createLineElement(text) {
            const lineDiv = document.createElement('div');
            lineDiv.className = 'line';
            lineDiv.innerHTML = text.split('').map(char => `<span class="char">${char}</span>`).join('');
            return lineDiv;
        }

        function startGame() {
            linesWrapper.innerHTML = '';
            lines = [];
            currentCharIndex = 0;
            correctCharsCount = 0;
            gameStarted = true;
            initialMessage.style.display = 'none';
            statsContainer.style.display = 'none';

            const line1 = generateRandomLine();
            const line2 = generateRandomLine();
            lines.push(line1, line2);

            linesWrapper.appendChild(createLineElement(line1));
            linesWrapper.appendChild(createLineElement(line2));

            const lineElements = linesWrapper.querySelectorAll('.line');
            if (lineElements.length > 0) lineElements.forEach((line, index) => line.style.top = `${index * 2}em`);
            
            const firstChar = linesWrapper.querySelector('.line:first-child .char');
            if (firstChar) {
                firstChar.classList.add('current');
            }

            startTime = Date.now();
        }

        function handleKeyDown(event) {
            if (!gameStarted && event.key === 'Enter') {
                startGame();
                return;
            }
            if (!gameStarted) return;

            const typedKey = event.key.toLowerCase();
            const currentLineElement = linesWrapper.querySelector('.line:first-child');
            if (!currentLineElement) return;

            const currentCharElement = currentLineElement.querySelector(`.char:nth-child(${currentCharIndex + 1})`);
            if (!currentCharElement) return;

            const correctKey = lines.length > 0 && lines.length > 0 ? lines.shift()[currentCharIndex] : '';
            const currentLineText = linesWrapper.querySelector('.line:first-child').textContent;
            const actualCorrectKey = currentLineText.charAt(currentCharIndex);

            if (typedKey === actualCorrectKey) {
                currentCharElement.classList.add('correct');
                correctCharsCount++;
                currentCharIndex++;
                currentCharElement.classList.remove('current');

                if (currentCharIndex >= currentLineText.length) {
                    completeLine();
                } else {
                    const nextCharElement = currentLineElement.querySelector(`.char:nth-child(${currentCharIndex + 1})`);
                    if (nextCharElement) {
                         nextCharElement.classList.add('current');
                    }
                }
            } else if (typedKey.length === 1 && alphabet.includes(typedKey)) {
                gameOver();
            }
        }

        function completeLine() {
            gameStarted = false;

            const oldLine = linesWrapper.querySelector('.line:first-child');
            const secondLine = linesWrapper.querySelector('.line:nth-child(2)');

            if (secondLine) {
                oldLine.style.top = '-2em'; 
                secondLine.style.top = '0em';

                oldLine.addEventListener('transitionend', () => {
                    oldLine.remove();

                    lines.push(generateRandomLine());
                    const newLineElement = createLineElement(lines.slice(-1)[0]);
                    linesWrapper.appendChild(newLineElement);
                    newLineElement.style.top = '2em';

                    currentCharIndex = 0;
                    const newCurrentLine = linesWrapper.querySelector('.line:first-child');
                    if (newCurrentLine) {
                        const firstChar = newCurrentLine.querySelector('.char:first-child');
                        if(firstChar) firstChar.classList.add('current');
                    }
                    
                    gameStarted = true;
                }, { once: true });
            } else {
                gameOver();
            }
        }

        function gameOver() {
            gameStarted = false;
            
            const endTime = Date.now();
            let elapsedTime = (endTime - startTime) / 1000;
            if (elapsedTime <= 0.01) {
                elapsedTime = 0.01;
            }
            
            const wpm = (correctCharsCount / elapsedTime).toFixed(2);

            document.getElementById('current-correct').textContent = correctCharsCount;
            document.getElementById('current-time').textContent = elapsedTime.toFixed(2);
            document.getElementById('current-wpm').textContent = wpm;

            if (correctCharsCount > bestScore.correct) {
                bestScore.correct = correctCharsCount;
                bestScore.time = elapsedTime.toFixed(2);
                bestScore.wpm = wpm;
            } else if (correctCharsCount === bestScore.correct && elapsedTime < bestScore.time) {
                bestScore.time = elapsedTime.toFixed(2);
            }
            bestScore.wpm = (bestScore.correct / bestScore.time).toFixed(2);

            document.getElementById('best-correct').textContent = bestScore.correct;
            document.getElementById('best-time').textContent = bestScore.time === Infinity ? 'N/A' : bestScore.time;
            document.getElementById('best-wpm').textContent = bestScore.wpm === 'NaN' ? '0' : bestScore.wpm;

            statsContainer.style.display = 'block';
            initialMessage.style.display = 'none';
        }
    </script>
</body>
</html>
